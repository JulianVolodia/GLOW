<!DOCTYPE HTML>
<html lang="en">
	<head>
		<title>GLOW</title>
		<meta charset="utf-8">
		<style type="text/css">
			body {
				background:#000;
				color:#fff;
				padding:0;
				margin:0;
				overflow:hidden;
				font-family:georgia;
				text-align:center;
			}
		</style>
	</head>
	<body>
		<div id="container"></div>

		<script type="text/javascript" src="http://mrdoob.github.com/three.js/build/Three.js"></script>
		
		<script type="text/javascript" src="src/GLOW.js"></script>
		<script type="text/javascript" src="src/core/Context.js"></script>
		<script type="text/javascript" src="src/core/Compiler.js"></script>
		<script type="text/javascript" src="src/core/CompiledData.js"></script>
		<script type="text/javascript" src="src/core/FBO.js"></script>
		<script type="text/javascript" src="src/core/Texture.js"></script>
		<script type="text/javascript" src="src/core/Cache.js"></script>
		
		<script type="text/javascript" src="src/shader/Shader.js"></script>
		<script type="text/javascript" src="src/shader/Elements.js"></script>
		<script type="text/javascript" src="src/shader/Uniform.js"></script>
		<script type="text/javascript" src="src/shader/Attribute.js"></script>

		<script type="text/javascript" src="src/extras/compatibility/Three.js"></script>

<!--		<script type="text/javascript" src="src/extras/math/Float.js"></script>
		<script type="text/javascript" src="src/extras/math/Int.js"></script>
		<script type="text/javascript" src="src/extras/math/Vector2.js"></script>
		<script type="text/javascript" src="src/extras/math/Vector3.js"></script>
		<script type="text/javascript" src="src/extras/math/Vector4.js"></script>
		<script type="text/javascript" src="src/extras/math/Matrix3.js"></script>
		<script type="text/javascript" src="src/extras/math/Matrix4.js"></script>

		<script type="text/javascript" src="src/extras/graph/Node.js"></script>
		<script type="text/javascript" src="src/extras/graph/Camera.js"></script>-->

		<script type="text/javascript" src="src/extras/geometry/Geometry.js"></script>
		<script type="text/javascript" src="src/extras/geometry/Cube.js"></script>
		<script type="text/javascript" src="src/extras/geometry/Plane.js"></script>

		<script type="text/javascript" src="examples/external/Stats.js"></script>

		<script type="text/javascript">
		
			var camera = new THREE.Camera( 50, window.innerWidth / window.innerHeight, 0.1, 10000 );
			camera.position.z = 1500;
			camera.update();
			
			var obj = new THREE.Object3D();
		
			var shaderInfo = {
				
				data: {

					transform: obj.matrixWorld,
					cameraInverse: camera.matrixWorldInverse,
					cameraProjection: camera.projectionMatrix,
					vertices: GLOW.Geometry.Cube.vertices( 500 )
				},

				elements: GLOW.Geometry.Cube.elements(),
	
				vertexShader: [

					"uniform	mat4 	transform;",
					"uniform 	mat4 	cameraInverse;",
					"uniform 	mat4 	cameraProjection;",

					"attribute 	vec3 	vertices;",

					"void main(void)",
					"{",
						"gl_Position = cameraProjection * cameraInverse * cameraInverse * transform * vec4( vertices, 1.0 );",
					"}"
						
				].join( "\n" ),

				fragmentShader: [ 	

					"#ifdef GL_ES",
						"precision highp float;",
					"#endif",		

					"void main( void )",
					"{",
						"vec3 color = vec3( sin( gl_FragCoord.x ), cos( gl_FragCoord.y ), sin( gl_FragCoord.z ));",
						"gl_FragColor = vec4( color, 1.0 );",
					"}"

				].join( "\n" )
			}
			
/*			var postShaderInfo = {
				
				data: {
					
					fboTexture: undefined,
					vertices: GLOW.Geometry.Plane.vertices(),
					uvs: GLOW.Geometry.Plane.uvs(), 
					offset: new GLOW.Vector4()
				},

				elements: GLOW.Geometry.Plane.elements(),
				
				vertexShader: [

					"attribute 	vec3 	vertices;",
					"attribute  vec2	uvs;",
					"varying 	vec2	uv;",

					"void main(void)",
					"{",
						"uv = uvs;",
						"gl_Position = vec4( vertices.x, vertices.y, 1.0, 1.0 );",
					"}"
						
				].join( "\n" ),

				fragmentShader: [ 	

					"#ifdef GL_ES",
						"precision highp float;",
					"#endif",		

					"uniform    vec4    	offset;",
					"uniform 	sampler2D 	fboTexture;",
					"varying 	vec2		uv;",

					"void main( void )",
					"{",
						"gl_FragColor = texture2D( fboTexture, offset.xy + vec2( uv.x + sin( gl_FragCoord.x * 0.01 * offset.z ) * 0.1, uv.y + cos( gl_FragCoord.y * 0.01 ) * 0.1 * offset.w ));",
					"}"

				].join( "\n" )
			}
*/		

			var container, stats;
			var mouseX = 0, mouseY = 0;
			var shader, shaders, topNode, context, t = 0;
			var postShader, t = 0;

			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;
			var FBO;
			
			
			// init cubes
			
			GLOW.ThreeJS.init();
			
			context = new GLOW.Context();
			shader = new GLOW.Shader( shaderInfo );

			
			// init dom and camera
			
			container = document.getElementById( 'container' );
			container.appendChild( context.domElement );
			
			
			// stats

			stats = new Stats();
			stats.domElement.style.position = 'absolute';
			stats.domElement.style.top = '0px';
			container.appendChild( stats.domElement );

				
			// render

			document.addEventListener( 'mousemove', onDocumentMouseMove, false );
			setInterval( render, 1000 / 30 );

			function render() {

				obj.rotation.x += 0.1;
				obj.rotation.y += 0.1;
				obj.rotation.z += 0.1;
				obj.update();

				context.cache.clear();
				context.clear();
				shader.draw();

				stats.update();
			}


			//--- on mouse move ---
			
			function onDocumentMouseMove( event ) {

				mouseX = ( event.clientX - windowHalfX ) / windowHalfX * 2; 
				mouseY = ( event.clientY - windowHalfY ) / windowHalfY * 2;
			}
		</script>
	</body>
</html>
