// GLOWCore.js r1 - http://github.com/empaempa/GLOW
var GLOW=function(){var a={},b={},d=-1;a.currentContext={};a.registerContext=function(e){b[e.id]=e;a.enableContext(e)};a.getContextById=function(e){if(b[e])return b[e];console.error("Couldn't find context id "+e+", returning current with id "+a.currentContext.id);return a.currentContext};a.enableContext=function(b){a.currentContext=typeof b==="string"?getContextById(b):b;GL=a.GL=a.currentContext.GL};a.uniqueId=function(){return++d};return a}(),GL={};
GLOW.Context=function(a){a===void 0&&(a={});this.id=a.id!==void 0?a.id:GLOW.uniqueId();this.alpha=a.alpha!==void 0?a.alpha:!0;this.depth=a.depth!==void 0?a.depth:!0;this.antialias=a.antialias!==void 0?a.antialias:!0;this.stencil=a.stencil!==void 0?a.stencil:!1;this.premultipliedAlpha=a.premultipliedAlpha!==void 0?a.premultipliedAlpha:!0;this.preserveDrawingBuffer=a.preserveDrawingBuffer!==void 0?a.preserveDrawingBuffer:!1;this.width=a.width!==void 0?a.width:window.innerWidth;this.height=a.height!==
void 0?parmaeters.height:window.innerHeight;try{this.domElement=document.createElement("canvas"),this.GL=this.domElement.getContext("experimental-webgl",{alpha:this.alpha,depth:this.depth,antialias:this.antialias,stencil:this.stencil,premultipliedAlpha:this.premultipliedAlpha,preserveDrawingBuffer:this.preserveDrawingBuffer}),this.domElement.width=this.width,this.domElement.height=this.height,this.GL.viewport(0,0,this.width,this.height)}catch(b){console.error("GLOW.Context.construct: "+b)}GLOW.registerContext(this);
this.cache=new GLOW.Cache;this.enableCulling(!1);this.enableDepthTest(!0,{func:GL.LEQUAL,write:!0,zNear:0,zFar:1});this.enableBlend(!1);this.setupClear({clearBits:GL.COLOR_BUFFER_BIT|GL.DEPTH_BUFFER_BIT});this.clear()};
GLOW.Context.prototype.setupClear=function(a){var b=a.depth!==void 0?Math.min(1,Math.max(0,a.depth)):1;GL.clearColor(a.red!==void 0?Math.min(1,Math.max(0,a.red)):0,a.green!==void 0?Math.min(1,Math.max(0,a.green)):0,a.blue!==void 0?Math.min(1,Math.max(0,a.blue)):0,a.alpha!==void 0?Math.min(1,Math.max(0,a.alpha)):1);GL.clearDepth(b);this.clearBits=a.clearBits!==void 0?a.clearBits:this.clearBits;return this};GLOW.Context.prototype.clear=function(a){if(a===void 0)a=this.clearBits;GL.clear(a);return this};
GLOW.Context.prototype.enableBlend=function(a,b){a?(GL.enable(GL.BLEND),b&&this.setupBlend(b)):GL.disable(GL.BLEND);return this};
GLOW.Context.prototype.setupBlend=function(a){if(a.equationRGB)try{a.equationAlpha&&GL.blendEquationSeparate(a.equationRGB,a.equationAlpha),a.srcRGB&&GL.blendFuncSeparate(a.srcRGB,a.dstRGB,a.srcAlpha,a.dstAlpha)}catch(b){console.error("GLOW.Context.setupBlend: "+b)}else try{a.equation&&GL.blendEquation(a.equation),a.src&&GL.blendFunc(a.src,a.dst)}catch(d){console.error("GLOW.Context.setupBlend: "+d)}return this};
GLOW.Context.prototype.enableDepthTest=function(a,b){a?(GL.enable(GL.DEPTH_TEST),b&&this.setupDepthTest(b)):GL.disable(GL.DEPTH_TEST);return this};GLOW.Context.prototype.setupDepthTest=function(a){try{a.func!==void 0&&GL.depthFunc(a.func),a.write!==void 0&&GL.depthMask(a.write),a.zNear!==void 0&&a.zFar!==void 0&&a.zNear<=a.zFar&&GL.depthRange(Math.max(0,Math.min(1,a.zNear)),Math.max(0,Math.min(1,a.zFar)))}catch(b){console.log("GLOW.Context.setupDepthTest: "+b)}return this};
GLOW.Context.prototype.enableStencilTest=function(a,b){a?(GL.enable(GL.STENCIL_TEST),b&&this.setupStencilTest(b)):GL.disable(GL.STENCIL_TEST);return this};GLOW.Context.prototype.setupStencilTest=function(){return this};GLOW.Context.prototype.enableCulling=function(a,b){a?(GL.enable(GL.CULL_FACE),b&&this.setupCulling(b)):GL.disable(GL.CULL_FACE);return this};
GLOW.Context.prototype.setupCulling=function(a){try{a.frontFace&&GL.frontFace(a.frontFace),a.cullFace&&GL.cullFace(a.cullFace)}catch(b){console.error("GLOW.Context.setupCulling: "+b)}return this};GLOW.Context.prototype.enableScissorTest=function(a,b){a?(GL.enable(GL.SCISSOR_TEST),b&&this.setupScissorTest(b)):GL.disable(GL.SCISSOR_TEST);return this};GLOW.Context.prototype.setupScissorTest=function(){return this};GLOW.Context.prototype.setupViewport=function(){return this};
GLOW.Compiler=function(){var a={},b=[];a.compile=function(d,e,c,g){var f,h=b.length,i;for(f=0;f<h;f++)if(i=b[f],d===i.vertexShaderCode&&e===i.fragmentShaderCode)break;f===h?(f=a.linkProgram(a.compileVertexShader(d),a.compileFragmentShader(e)),b.push({vertexShaderCode:d,fragmentShaderCode:e,program:f})):f=i.program;return new GLOW.CompiledData(f,a.createUniforms(a.extractUniforms(f),c),a.createAttributes(a.extractAttributes(f),c),a.createElements(g))};a.compileVertexShader=function(a){var b;b=GL.createShader(GL.VERTEX_SHADER);
b.id=GLOW.uniqueId();GL.shaderSource(b,a);GL.compileShader(b);GL.getShaderParameter(b,GL.COMPILE_STATUS)||console.error("GLOW.Compiler.compileVertexShader: "+GL.getShaderInfoLog(b));return b};a.compileFragmentShader=function(a){var b;b=GL.createShader(GL.FRAGMENT_SHADER);b.id=GLOW.uniqueId();GL.shaderSource(b,a);GL.compileShader(b);GL.getShaderParameter(b,GL.COMPILE_STATUS)||console.error("GLOW.Compiler.compileFragmentShader: "+GL.getShaderInfoLog(b));return b};a.linkProgram=function(b,a){var c;c=
GL.createProgram();c.id=GLOW.uniqueId();GL.attachShader(c,b);GL.attachShader(c,a);GL.linkProgram(c);GL.getProgramParameter(c,GL.LINK_STATUS)||console.error("GLOW.Compiler.linkProgram: Could not initialise program");return c};a.extractUniforms=function(b){for(var a={},c,g=0;;){c=GL.getActiveUniform(b,g);if(c!==null&&c!==-1&&c!==void 0)c={name:c.name.split("[")[0],size:c.size,type:c.type,location:GL.getUniformLocation(b,c.name.split("[")[0]),locationNumber:g},a[c.name]=c;else break;g++}return a};a.extractAttributes=
function(b){for(var a,c=0,g={};;){a=GL.getActiveAttrib(b,c);if(a!==null&&a!==-1&&a!==void 0)a={name:a.name,size:a.size,type:a.type,location:GL.getAttribLocation(b,a.name),locationNumber:c},g[a.name]=a;else break;c++}b.highestAttributeNumber=c-1;return g};a.createUniforms=function(a,b){var c,g={},f,h,i=0;for(c in a)f=a[c],h=f.name,b[h]===void 0?console.warn("GLOW.Compiler.createUniforms: missing declaration for uniform "+h):b[h]instanceof GLOW.Uniform?g[h]=b[h]:(g[h]=new GLOW.Uniform(f,b[h]),g[h].type===
GL.SAMPLER_2D&&g[h].data.init(i++));return g};a.createAttributes=function(a,b){var c,g,f,h={};for(c in a)g=a[c],f=g.name,b[f]===void 0?console.warning("GLOW.Compiler.createAttributes: missing declaration for attribute "+f):h[f]=b[f]instanceof GLOW.Attribute?b[f]:new GLOW.Attribute(g,b[f]);return h};a.createElements=function(a){var b;a?a instanceof GLOW.Elements?b=a:(a instanceof Uint16Array||(a=new Uint16Array(a)),b=new GLOW.Elements(a)):console.error("GLOW.Compiler.createElements: missing 'elements' in supplied data. Quitting.");
return b};return a}();
GLOW.CompiledData=function(){function a(a,d,e,c){this.program=a;this.uniforms=d!==void 0?d:{};this.attributes=e!==void 0?e:{};this.elements=c}a.prototype.clone=function(a){var d=new GLOW.CompiledData,e;for(e in this.uniforms)d.uniforms[e]=a[e]?new GLOW.Uniform(this.uniforms[e],a[e]):this.uniforms[e];for(var c in this.attributes)d.attributes[c]=a[c]?new GLOW.Attribute(this.attributes[c],a[c]):this.attributes[c];d.elements=a.elements?new GLOW.Elements(a.elements):this.elements;d.program=this.program;
return d};return a}();
GLOW.Cache=function(){function a(){this.highestAttributeNumber=-1;this.uniformByLocation=[];this.attributeByLocation=[];this.textureByLocation=[];this.programId=this.elementId=-1}a.prototype.programCached=function(a){if(a.id===this.programId)return!0;this.programId=a.id;return!1};a.prototype.setProgramHighestAttributeNumber=function(a){var d=this.highestAttributeNumber;this.highestAttributeNumber=a.highestAttributeNumber;return a.highestAttributeNumber-d};a.prototype.uniformCached=function(a){if(this.uniformByLocation[a.locationNumber]===
a.id)return!0;this.uniformByLocation[a.locationNumber]=a.id;return!1};a.prototype.attributeCached=function(a){if(this.attributeByLocation[a.locationNumber]===a.id)return!0;this.attributeByLocation[a.locationNumber]=a.id;return!1};a.prototype.textureCached=function(a){if(this.textureByLocation[a.textureUnit]===a.id)return!0;this.textureByLocation[a.textureUnit]=a.id;return!1};a.prototype.elementsCached=function(a){if(a.id===this.elementId)return!0;this.elementId=a.id;return!1};a.prototype.clear=function(){this.highestAttributeNumber=
-1;this.uniformByLocation.length=0;this.attributeByLocation.length=0;this.textureByLocation.length=0;this.programId=this.elementId=-1};return a}();
GLOW.FBO=function(){function a(a){a=a!==void 0?a:{};this.id=GLOW.uniqueId();this.width=a.width!==void 0?a.width:window.innerWidth;this.height=a.height!==void 0?a.height:window.innerHeight;var d=a.wrapS!==void 0?a.wrapS:GL.CLAMP_TO_EDGE,e=a.wrapT!==void 0?a.wrapT:GL.CLAMP_TO_EDGE,c=a.magFilter!==void 0?a.magFilter:GL.LINEAR,g=a.minFilter!==void 0?a.minFilter:GL.LINEAR,f=a.format!==void 0?a.format:GL.RGBA,h=a.depth!==void 0?a.depth:!0,a=a.stencil!==void 0?paramaters.stencil:!1;this.textureUnit=-1;this.frameBuffer=
GL.createFramebuffer();this.renderBuffer=GL.createRenderbuffer();this.texture=GL.createTexture();this.viewport={x:0,y:0,width:this.width,height:this.height};try{GL.bindTexture(GL.TEXTURE_2D,this.texture),GL.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_S,d),GL.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_T,e),GL.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MAG_FILTER,c),GL.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MIN_FILTER,g),GL.texImage2D(GL.TEXTURE_2D,0,f,this.width,this.height,0,f,GL.UNSIGNED_BYTE,null),
GL.bindRenderbuffer(GL.RENDERBUFFER,this.renderBuffer),GL.bindFramebuffer(GL.FRAMEBUFFER,this.frameBuffer),GL.framebufferTexture2D(GL.FRAMEBUFFER,GL.COLOR_ATTACHMENT0,GL.TEXTURE_2D,this.texture,0),h&&!a?(GL.renderbufferStorage(GL.RENDERBUFFER,GL.DEPTH_COMPONENT16,this.width,this.height),GL.framebufferRenderbuffer(GL.FRAMEBUFFER,GL.DEPTH_ATTACHMENT,GL.RENDERBUFFER,this.renderBuffer)):h&&a?(GL.renderbufferStorage(GL.RENDERBUFFER,GL.DEPTH_STENCIL,width,height),GL.framebufferRenderbuffer(GL.FRAMEBUFFER,
GL.DEPTH_STENCIL_ATTACHMENT,GL.RENDERBUFFER,this.renderBuffer)):GL.renderbufferStorage(GL.RENDERBUFFER,GL.RGBA4,this.width,this.height),GL.bindTexture(GL.TEXTURE_2D,null),GL.bindRenderbuffer(GL.RENDERBUFFER,null),GL.bindFramebuffer(GL.FRAMEBUFFER,null)}catch(i){console.error("GLOW.FBO.construct: "+i)}}a.prototype.init=function(a){this.textureUnit=a};a.prototype.bind=function(){GL.bindFramebuffer(GL.FRAMEBUFFER,this.frameBuffer);GL.viewport(this.viewport.x,this.viewport.y,this.viewport.width,this.viewport.height);
return this};a.prototype.unbind=function(){GL.bindFramebuffer(GL.FRAMEBUFFER,null);GL.viewport(0,0,GLOW.currentContext.width,GLOW.currentContext.height);return this};a.prototype.setupViewport=function(a){this.viewport.x=a.x!==void 0?a.x:0;this.viewport.y=a.y!==void 0?a.y:0;this.viewport.width=a.width!==void 0?a.width:window.innerWidth;this.viewport.height=a.height!==void 0?a.height:window.innerHeight;return this};a.prototype.resize=function(){return this};a.prototype.generateMipMaps=function(){GL.bindTexture(GL.TEXTURE_2D,
this.texture);GL.generateMipmap(GL.TEXTURE_2D);GL.bindTexture(GL.TEXTURE_2D,null);return this};return a}();GLOW.Texture=function(a){this.url=a;this.id=GLOW.uniqueId();this.textureUnit=-1;this.texture=void 0;this.image=new Image;this.image.scope=this};GLOW.Texture.prototype.init=function(a){this.textureUnit=a;this.image.onload=this.onLoad;this.image.src=this.url};
GLOW.Texture.prototype.onLoad=function(){var a=this.scope;a.texture=GL.createTexture();GL.bindTexture(GL.TEXTURE_2D,a.texture);GL.texImage2D(GL.TEXTURE_2D,0,GL.RGBA,GL.RGBA,GL.UNSIGNED_BYTE,this);GL.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_S,GL.REPEAT);GL.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_T,GL.REPEAT);GL.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MAG_FILTER,GL.LINEAR);GL.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MIN_FILTER,GL.LINEAR_MIPMAP_LINEAR);GL.generateMipmap(GL.TEXTURE_2D)};
GLOW.Shader=function(){function a(a){this.id=GLOW.uniqueId();this.compiledData=a.use?a.use.clone(a.except):GLOW.Compiler.compile(a.vertexShader,a.fragmentShader,a.data,a.elements);this.attachData()}a.prototype.attachData=function(){var a,d;for(a in this.compiledData.uniforms)this[a]===void 0?this[a]=this.compiledData.uniforms[a].data:console.warn("GLOW.Shader.attachUniformAndAttributeData: name collision on uniform "+a+", not attaching for easy access. Please use Shader.uniforms."+a+".data to access data.");
for(d in this.compiledData.attributes)this[d]===void 0?this[d]=this.compiledData.attributes[d].data:console.warn("GLOW.Shader.attachUniformAndAttributeData: name collision on attribute "+d+", not attaching for easy access. Please use Shader.attributes."+d+".data to access data.")};a.prototype.draw=function(){var a=this.compiledData,d=GLOW.currentContext.cache;if(!d.programCached(a.program)){var e=d.setProgramHighestAttributeNumber(a.program);if(e){var c=a.program.highestAttributeNumber,g=c-e+1;if(e>
0)for(;g<=c;g++)GL.enableVertexAttribArray(g);else for(;g>=c;g--)GL.disableVertexAttribArray(g)}GL.useProgram(a.program)}for(var f in a.uniforms)d.uniformCached(a.uniforms[f])||a.uniforms[f].load();for(var h in a.attributes)d.attributeCached(a.attributes[h])||a.attributes[h].bind();a.elements.draw()};a.prototype.clone=function(a){return new GLOW.Shader({use:this.compiledData,except:a})};a.prototype.dispose=function(){};return a}();
GLOW.Elements=function(){function a(a){this.id=GLOW.uniqueId();this.elements=GL.createBuffer();this.length=a.length;GL.bindBuffer(GL.ELEMENT_ARRAY_BUFFER,this.elements);GL.bufferData(GL.ELEMENT_ARRAY_BUFFER,a,GL.STATIC_DRAW)}a.prototype.draw=function(){GLOW.currentContext.cache.elementsCached(this)||GL.bindBuffer(GL.ELEMENT_ARRAY_BUFFER,this.elements);GL.drawElements(GL.TRIANGLES,this.length,GL.UNSIGNED_SHORT,0)};return a}();
GLOW.Uniform=function(){function a(){e[GL.INT]=function(){GL.uniform1i(this.location,this.value())};e[GL.INT_VEC2]=function(){GL.uniform2i(this.location,this.value(0),this.value(1))};e[GL.INT_VEC3]=function(){GL.uniform3i(this.location,this.value(0),this.value(1),this.value(2))};e[GL.INT_VEC4]=function(){GL.uniform4i(this.location,this.value(0),this.value(1),this.value(2),this.value(3))};e[GL.FLOAT]=function(){GL.uniform1f(this.location,this.value())};e[GL.FLOAT_VEC2]=function(){GL.uniform2f(this.location,
this.value(0),this.value(1))};e[GL.FLOAT_VEC3]=function(){GL.uniform3f(this.location,this.value(0),this.value(1),this.value(2))};e[GL.FLOAT_VEC4]=function(){GL.uniform4f(this.location,this.value(0),this.value(1),this.value(2),this.value(3))};e[GL.FLOAT_MAT2]=function(){GL.uniformMatrix2fv(this.location,!1,this.value())};e[GL.FLOAT_MAT3]=function(){GL.uniformMatrix3fv(this.location,!1,this.value())};e[GL.FLOAT_MAT4]=function(){GL.uniformMatrix4fv(this.location,!1,this.value())};e[GL.SAMPLER_2D]=function(){this.data.texture!==
void 0&&this.data.textureUnit!==-1&&!GLOW.currentContext.cache.textureCached(this.data)&&(GL.uniform1i(this.location,this.data.textureUnit),GL.activeTexture(GL.TEXTURE0+this.data.textureUnit),GL.bindTexture(GL.TEXTURE_2D,this.data.texture))};e[GL.SAMPLER_CUBE]=function(){};c[GL.INT]=function(){GL.uniform1iv(this.location,this.value())};c[GL.INT_VEC2]=function(){GL.uniform2iv(this.location,this.value())};c[GL.INT_VEC3]=function(){GL.uniform3iv(this.location,this.value())};c[GL.INT_VEC4]=function(){GL.uniform4iv(this.location,
this.value())};c[GL.FLOAT]=function(){GL.uniform1fv(this.location,this.value())};c[GL.FLOAT_VEC2]=function(){GL.uniform2fv(this.location,this.value())};c[GL.FLOAT_VEC3]=function(){GL.uniform3fv(this.location,this.value())};c[GL.FLOAT_VEC4]=function(){GL.uniform4fv(this.location,this.value())}}function b(b,f){d||(d=!0,a());this.id=GLOW.uniqueId();this.data=f;this.name=b.name;this.length=b.length;this.type=b.type;this.location=b.location;this.locationNumber=b.locationNumber;this.load=b.loadFunction||
this.length!==void 0&&this.length>1?c[this.type]:e[this.type]}var d=!1,e=[],c=[];b.prototype.value=function(a){return a===void 0?this.data.value:this.data.value[a]};return b}();
GLOW.Attribute=function(){function a(a,c,g){b||(b=!0,d[GL.INT]=1,d[GL.INT_VEC2]=2,d[GL.INT_VEC3]=3,d[GL.INT_VEC4]=4,d[GL.FLOAT]=1,d[GL.FLOAT_VEC2]=2,d[GL.FLOAT_VEC3]=3,d[GL.FLOAT_VEC4]=4,d[GL.FLOAT_MAT2]=4,d[GL.FLOAT_MAT3]=9,d[GL.FLOAT_MAT4]=16);this.id=GLOW.uniqueId();this.data=c;this.location=a.location;this.locationNumber=a.locationNumber;this.offset=this.stride=0;this.size=d[a.type];this.buffer=GL.createBuffer();this.name=a.name;this.type=a.type;if(!g)if(this.data instanceof Float32Array)this.setData(this.data);
else{for(var a=this.data.length,g=this.size,f=new Float32Array(a*g),h=0,i=0;i<a;i++)for(var j=0;j<g;j++)f[h++]=c[i].value[j];this.setData(f)}}var b=!1,d=[];a.prototype.interleave=function(a,b,d){this.stride=b;this.offset=d};a.prototype.setData=function(a){this.data=a;GL.bindBuffer(GL.ARRAY_BUFFER,this.buffer);GL.bufferData(GL.ARRAY_BUFFER,this.data,GL.STATIC_DRAW)};a.prototype.bind=function(){GL.bindBuffer(GL.ARRAY_BUFFER,this.buffer);GL.vertexAttribPointer(this.location,this.size,GL.FLOAT,!1,this.stride,
this.offset)};return a}();
