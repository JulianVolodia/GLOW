// GLOWCore.js r1.1 - http://github.com/empaempa/GLOW
var GLOW=function(){var c={},a={},b=-1;c.currentContext={};c.registerContext=function(b){a[b.id]=b;c.enableContext(b)};c.getContextById=function(b){if(a[b])return a[b];console.error("Couldn't find context id "+b+", returning current with id "+c.currentContext.id);return c.currentContext};c.enableContext=function(a){c.currentContext=typeof a==="string"?getContextById(a):a;GL=c.GL=c.currentContext.GL};c.uniqueId=function(){return++b};return c}(),GL={};
GLOW.Context=function(){function c(a){a===void 0&&(a={});this.id=a.id!==void 0?a.id:GLOW.uniqueId();this.alpha=a.alpha!==void 0?a.alpha:!0;this.depth=a.depth!==void 0?a.depth:!0;this.antialias=a.antialias!==void 0?a.antialias:!0;this.stencil=a.stencil!==void 0?a.stencil:!1;this.premultipliedAlpha=a.premultipliedAlpha!==void 0?a.premultipliedAlpha:!0;this.preserveDrawingBuffer=a.preserveDrawingBuffer!==void 0?a.preserveDrawingBuffer:!1;this.width=a.width!==void 0?a.width:window.innerWidth;this.height=
a.height!==void 0?a.height:window.innerHeight;this.cache=new GLOW.Cache;if(a.context)this.GL=a.context,GLOW.registerContext(this);else{try{this.domElement=document.createElement("canvas"),this.GL=this.domElement.getContext("experimental-webgl",{alpha:this.alpha,depth:this.depth,antialias:this.antialias,stencil:this.stencil,premultipliedAlpha:this.premultipliedAlpha,preserveDrawingBuffer:this.preserveDrawingBuffer}),this.domElement.width=this.width,this.domElement.height=this.height}catch(b){console.error("GLOW.Context.construct: "+
b)}GLOW.registerContext(this);this.enableCulling(!0,{frontFace:GL.CCW,cullFace:GL.BACK});this.enableDepthTest(!0,{func:GL.LEQUAL,write:!0,zNear:0,zFar:1});this.enableBlend(!1);this.setupClear({clearBits:GL.COLOR_BUFFER_BIT|GL.DEPTH_BUFFER_BIT});this.setupViewport({x:0,y:0,width:this.width,height:this.height});this.clear()}}c.prototype.setupClear=function(a){var b=a.depth!==void 0?Math.min(1,Math.max(0,a.depth)):1;GL.clearColor(a.red!==void 0?Math.min(1,Math.max(0,a.red)):0,a.green!==void 0?Math.min(1,
Math.max(0,a.green)):0,a.blue!==void 0?Math.min(1,Math.max(0,a.blue)):0,a.alpha!==void 0?Math.min(1,Math.max(0,a.alpha)):1);GL.clearDepth(b);this.clearBits=a.clearBits!==void 0?a.clearBits:this.clearBits;return this};c.prototype.clear=function(a){if(a===void 0)a=this.clearBits;GL.clear(a);return this};c.prototype.enableBlend=function(a,b){a?(GL.enable(GL.BLEND),b&&this.setupBlend(b)):GL.disable(GL.BLEND);return this};c.prototype.setupBlend=function(a){a.equationRGB?(a.equationAlpha&&GL.blendEquationSeparate(a.equationRGB,
a.equationAlpha),a.srcRGB&&GL.blendFuncSeparate(a.srcRGB,a.dstRGB,a.srcAlpha,a.dstAlpha)):(a.equation&&GL.blendEquation(a.equation),a.src&&GL.blendFunc(a.src,a.dst));return this};c.prototype.enableDepthTest=function(a,b){a?(GL.enable(GL.DEPTH_TEST),b&&this.setupDepthTest(b)):GL.disable(GL.DEPTH_TEST);return this};c.prototype.setupDepthTest=function(a){a.func!==void 0&&GL.depthFunc(a.func);a.write!==void 0&&GL.depthMask(a.write);a.zNear!==void 0&&a.zFar!==void 0&&a.zNear<=a.zFar&&GL.depthRange(Math.max(0,
Math.min(1,a.zNear)),Math.max(0,Math.min(1,a.zFar)));return this};c.prototype.enablePolygonOffset=function(a,b){a?(GL.enable(GL.POLYGON_OFFSET_FILL),b&&this.setupPolygonOffset(b)):GL.disable(GL.POLYGON_OFFSET_FILL);return this};c.prototype.setupPolygonOffset=function(a){a.factor&&a.units&&GL.polygonOffset(a.factor,a.units)};c.prototype.enableStencilTest=function(a,b){a?(GL.enable(GL.STENCIL_TEST),b&&this.setupStencilTest(b)):GL.disable(GL.STENCIL_TEST);return this};c.prototype.setupStencilTest=function(a){a.func&&
a.funcFace?GL.stencilFuncSeparate(a.funcFace,a.func,a.funcRef,a.funcMask):a.func&&GL.stencilFunc(a.func,a.funcRef,a.funcMask);a.mask&&a.maskFace?GL.stencilMaskSeparate(a.maskFace,a.mask):a.mask&&GL.stencilMask(a.mask);a.opFail&&a.opFace?GL.stencilOpSeparate(a.opFace,a.opFail,a.opZfail,a.opZpass):a.opFail&&GL.stencilOp(a.opFail,a.opZfail,a.opZpass);return this};c.prototype.enableCulling=function(a,b){a?(GL.enable(GL.CULL_FACE),b&&this.setupCulling(b)):GL.disable(GL.CULL_FACE);return this};c.prototype.setupCulling=
function(a){try{a.frontFace&&GL.frontFace(a.frontFace),a.cullFace&&GL.cullFace(a.cullFace)}catch(b){console.error("GLOW.Context.setupCulling: "+b)}return this};c.prototype.enableScissor=function(a,b){a?(GL.enable(GL.SCISSOR_TEST),b&&this.setupScissor(b)):GL.disable(GL.SCISSOR_TEST);return this};c.prototype.setupScissor=function(a){try{GL.scissor(a.x,a.y,a.width,a.height)}catch(b){console.error("GLOW.Context.setupScissorTest: "+b)}return this};c.prototype.setupViewport=function(a){var a=a!==void 0?
a:{},b=a.x!==void 0?a.x:0,d=a.y!==void 0?a.y:0,e=this.width=a.width!==void 0?a.width:window.innerWidth,a=this.height=a.height!==void 0?a.height:window.innerHeight;this.GL.viewport(b,d,e,a);return this};return c}();
GLOW.Compiler=function(){var c={};c.compile=function(a){var b=GLOW.currentContext.cache.codeCompiled(a.vertexShader,a.fragmentShader);b===void 0&&(b=c.linkProgram(c.compileVertexShader(a.vertexShader),c.compileFragmentShader(a.fragmentShader)),GLOW.currentContext.cache.addCompiledProgram(b));var d=c.createUniforms(c.extractUniforms(b),a.data),e=c.createAttributes(c.extractAttributes(b),a.data,a.usage,a.interleave),i=c.interleaveAttributes(e,a.interleave),f=a.elements,g=GL.TRIANGLES,h=a.usage?a.usage:
{},j=h.elements;if(a.triangles)f=a.triangles,j=h.triangles;else if(a.triangleStrip)f=a.triangleStrip,g=GL.TRIANGLE_STRIP,j=h.triangleStrip;else if(a.triangleFan)f=a.triangleFan,g=GL.TRIANGLE_FAN,j=h.triangleFan;else if(a.points)f=a.points,g=GL.POINTS,j=h.points;else if(a.lines)f=a.lines,g=GL.LINES,j=h.lines;else if(a.lineLoop)f=a.lineLoop,g=GL.LINE_LOOP,j=h.lineLoop;else if(a.lineStrip)f=a.lineStrip,g=GL.LINE_STRIP,j=h.lineStrip;f=c.createElements(f,g,j);return new GLOW.CompiledData(b,d,e,i,f,a)};
c.compileVertexShader=function(a){var b;b=GL.createShader(GL.VERTEX_SHADER);b.id=GLOW.uniqueId();GL.shaderSource(b,a);GL.compileShader(b);GL.getShaderParameter(b,GL.COMPILE_STATUS)||console.error("GLOW.Compiler.compileVertexShader: "+GL.getShaderInfoLog(b));return b};c.compileFragmentShader=function(a){var b;b=GL.createShader(GL.FRAGMENT_SHADER);b.id=GLOW.uniqueId();GL.shaderSource(b,a);GL.compileShader(b);GL.getShaderParameter(b,GL.COMPILE_STATUS)||console.error("GLOW.Compiler.compileFragmentShader: "+
GL.getShaderInfoLog(b));return b};c.linkProgram=function(a,b){var d;d=GL.createProgram();d.id=GLOW.uniqueId();GL.attachShader(d,a);GL.attachShader(d,b);GL.linkProgram(d);GL.getProgramParameter(d,GL.LINK_STATUS)||console.error("GLOW.Compiler.linkProgram: Could not initialise program");return d};c.extractUniforms=function(a){for(var b={},d,e=0;;){d=GL.getActiveUniform(a,e);if(d!==null&&d!==-1&&d!==void 0)d={name:d.name.split("[")[0],size:d.size,type:d.type,location:GL.getUniformLocation(a,d.name.split("[")[0]),
locationNumber:e},b[d.name]=d;else break;e++}return b};c.extractAttributes=function(a){for(var b,d=0,e={};;){b=GL.getActiveAttrib(a,d);if(b!==null&&b!==-1&&b!==void 0)b={name:b.name,size:b.size,type:b.type,location:GL.getAttribLocation(a,b.name),locationNumber:d},e[b.name]=b;else break;d++}a.highestAttributeNumber=d-1;return e};c.createUniforms=function(a,b){var d,e={},c,f,g=0;for(d in a)c=a[d],f=c.name,b[f]===void 0?console.warn("GLOW.Compiler.createUniforms: missing declaration for uniform "+f):
b[f]instanceof GLOW.Uniform?e[f]=b[f]:(e[f]=new GLOW.Uniform(c,b[f]),(e[f].type===GL.SAMPLER_2D||e[f].type===GL.SAMPLER_CUBE)&&e[f].data.init(g++));return e};c.createAttributes=function(a,b,d,e){var c,f,g,h={},e=e!==void 0?e:{},d=d!==void 0?d:{};for(c in a)f=a[c],g=f.name,b[g]===void 0?console.warn("GLOW.Compiler.createAttributes: missing declaration for attribute "+g):h[g]=b[g]instanceof GLOW.Attribute?b[g]:new GLOW.Attribute(f,b[g],d[g]!==void 0?d[g]:void 0,e[g]!==void 0?e[g]:!0);return h};c.interleaveAttributes=
function(a,b){var b=b!==void 0?b:{},d,e,c,f,g;e=0;var h=[];for(d in a)b[d]!==void 0&&b[d]!==!1&&(e=Math.max(e-1,b[d])+1);for(d in a)b[d]===void 0&&(b[d]=e);for(g in b)b[g]!==!1&&(h[b[g]]===void 0&&(h[b[g]]=[]),h[b[g]].push(a[g]));var j,k;d=0;for(e=h.length;d<e;d++)if(h[d]!==void 0){c=j=0;for(f=h[d].length;c<f;c++)if(j+h[d][c].size*4>255){console.warn("GLOW.Compiler.interleaveAttributes: Stride owerflow, moving attributes to new interleave index. Please check your interleave setup!");k=h.length;for(h[k]=
[];c<f;)h[k].push(h[d][c]),h[d].splice(c,1),f--}else j+=h[d][c].size*4}k={};d=0;for(e=h.length;d<e;d++)if(h[d]!==void 0){j="";c=0;for(f=h[d].length;c<f;c++)j+=c!==f-1?h[d][c].name+"_":h[d][c].name;k[j]=new GLOW.InterleavedAttributes(h[d])}for(g in b)b[g]!==!1&&delete a[g];return k};c.createElements=function(a,b,d){var c;a===void 0?console.error("GLOW.Compiler.createElements: missing 'elements' in supplied data. Quitting."):a instanceof GLOW.Elements?c=a:(a instanceof Uint16Array||(a=new Uint16Array(a)),
c=new GLOW.Elements(a,b,d!==void 0?d:GL.STATIC_DRAW));return c};return c}();
GLOW.CompiledData=function(){function c(a,b,d,c,i,f){this.program=a;this.uniforms=b!==void 0?b:{};this.attributes=d!==void 0?d:{};this.interleavedAttributes=c!==void 0?c:{};this.elements=i;f=f!==void 0?f:{};this.preDrawCallback=f.preDrawCallback;this.postDrawCallback=f.postDrawCallback;this.blend=f.blend;this.stencil=f.stencil}c.prototype.clone=function(a){var b=new GLOW.CompiledData,a=a!==void 0?a:{},d;for(d in this.uniforms)a[d]?(b.uniforms[d]=new GLOW.Uniform(this.uniforms[d],a[d]),(b.uniforms[d].type===
GL.SAMPLER_2D||b.uniforms[d].type===GL.SAMPLER_CUBE)&&b.uniforms[d].data.init(this.uniforms[d].data.textureUnit)):b.uniforms[d]=this.uniforms[d];for(var c in this.attributes)b.attributes[c]=a[c]?new GLOW.Attribute(this.attributes[c],a[c]):this.attributes[c];for(var i in this.interleavedAttributes)b.interleavedAttributes[i]=a[i]?new GLOW.InterleavedAttributes(a[i]):this.interleavedAttributes[i];b.elements=a.elements?new GLOW.Elements(a.elements):this.elements;b.program=a.program?a.program:this.program;
b.blend=a.blend?a.blend:this.blend;b.stencil=a.stencil?a.stencil:this.stencil;b.preDrawCallback=a.preDrawCallback?a.preDrawCallback:this.preDrawCallback;b.postDrawCallback=a.postDrawCallback?a.postDrawCallback:this.postDrawCallback;return b};return c}();
GLOW.Cache=function(){function c(){this.highestAttributeNumber=-1;this.uniformByLocation=[];this.attributeByLocation=[];this.textureByLocation=[];this.compiledCode=[];this.programId=this.elementId=-1;this.active=!0}c.prototype.codeCompiled=function(a,b){var d,c,i=this.compiledCode.length;for(c=0;c<i;c++)if(d=this.compiledCode[c],a===d.vertexShader&&b===d.fragmentShader)break;if(c===i)this.compiledCode.push({vertexShader:a,fragmentShader:b});else return this.compiledCode[c].program};c.prototype.addCompiledProgram=
function(a){this.compiledCode[this.compiledCode.length-1].program=a};c.prototype.programCached=function(a){if(this.active){if(a.id===this.programId)return!0;this.programId=a.id}return!1};c.prototype.setProgramHighestAttributeNumber=function(a){var b=this.highestAttributeNumber;this.highestAttributeNumber=a.highestAttributeNumber;return a.highestAttributeNumber-b};c.prototype.uniformCached=function(a){if(this.active){if(this.uniformByLocation[a.locationNumber]===a.id)return!0;this.uniformByLocation[a.locationNumber]=
a.id}return!1};c.prototype.attributeCached=function(a){if(this.active){if(this.attributeByLocation[a.locationNumber]===a.id)return!0;this.attributeByLocation[a.locationNumber]=a.id}return!1};c.prototype.textureCached=function(a){if(this.active){if(this.textureByLocation[a.textureUnit]===a.id)return!0;this.textureByLocation[a.textureUnit]=a.id}return!1};c.prototype.elementsCached=function(a){if(this.active){if(a.id===this.elementId)return!0;this.elementId=a.id}return!1};c.prototype.clear=function(){this.highestAttributeNumber=
-1;this.uniformByLocation.length=0;this.attributeByLocation.length=0;this.textureByLocation.length=0;this.programId=this.elementId=-1};return c}();
GLOW.FBO=function(){function c(b){b=b!==void 0?b:{};this.id=GLOW.uniqueId();this.width=b.width!==void 0?b.width:b.size!==void 0?b.size:window.innerWidth;this.height=b.height!==void 0?b.height:b.size!==void 0?b.size:window.innerHeight;var c=b.wrapS!==void 0?b.wrapS:b.wrap!==void 0?b.wrap:GL.CLAMP_TO_EDGE,e=b.wrapT!==void 0?b.wrapT:b.wrap!==void 0?b.wrap:GL.CLAMP_TO_EDGE,i=b.magFilter!==void 0?b.magFilter:GL.LINEAR,f=b.minFilter!==void 0?b.minFilter:GL.LINEAR,g=b.internalFormat!==void 0?b.internalFormat:
GL.RGBA,h=b.format!==void 0?b.format:GL.RGBA,j=b.type!==void 0?b.type:GL.UNSIGNED_BYTE,k=b.depth!==void 0?b.depth:!0,l=b.stencil!==void 0?b.stencil:!1;this.textureUnit=-1;this.textureType=b.cube!==!0?GL.TEXTURE_2D:GL.TEXTURE_CUBE_MAP;this.viewport={x:0,y:0,width:this.width,height:this.height};this.texture=GL.createTexture();GL.bindTexture(this.textureType,this.texture);GL.texParameteri(this.textureType,GL.TEXTURE_WRAP_S,c);GL.texParameteri(this.textureType,GL.TEXTURE_WRAP_T,e);GL.texParameteri(this.textureType,
GL.TEXTURE_MAG_FILTER,i);GL.texParameteri(this.textureType,GL.TEXTURE_MIN_FILTER,f);if(this.textureType===GL.TEXTURE_2D)GL.texImage2D(this.textureType,0,g,this.width,this.height,0,h,j,null);else for(b=0;b<6;b++)GL.texImage2D(GL.TEXTURE_CUBE_MAP_POSITIVE_X+b,0,g,this.width,this.height,0,h,j,null);if(k||l)this.renderBuffer=GL.createRenderbuffer(),GL.bindRenderbuffer(GL.RENDERBUFFER,this.renderBuffer),k&&!l?GL.renderbufferStorage(GL.RENDERBUFFER,GL.DEPTH_COMPONENT16,this.width,this.height):!k&&l?GL.renderbufferStorage(GL.RENDERBUFFER,
GL.STENCIL_INDEX8,this.width,this.height):k&&l&&GL.renderbufferStorage(GL.RENDERBUFFER,GL.DEPTH_STENCIL,this.width,this.height);if(this.textureType===GL.TEXTURE_2D)this.frameBuffer=GL.createFramebuffer(),GL.bindFramebuffer(GL.FRAMEBUFFER,this.frameBuffer),GL.framebufferTexture2D(GL.FRAMEBUFFER,GL.COLOR_ATTACHMENT0,GL.TEXTURE_2D,this.texture,0),k&&!l?GL.framebufferRenderbuffer(GL.FRAMEBUFFER,GL.DEPTH_ATTACHMENT,GL.RENDERBUFFER,this.renderBuffer):!k&&l?GL.framebufferRenderbuffer(GL.FRAMEBUFFER,GL.STENCIL_ATTACHMENT,
GL.RENDERBUFFER,this.renderBuffer):k&&l&&GL.framebufferRenderbuffer(GL.FRAMEBUFFER,GL.DEPTH_STENCIL_ATTACHMENT,GL.RENDERBUFFER,this.renderBuffer);else{this.frameBuffers={};for(var m in a)this.frameBuffers[m]=GL.createFramebuffer(),GL.bindFramebuffer(GL.FRAMEBUFFER,this.frameBuffers[m]),GL.framebufferTexture2D(GL.FRAMEBUFFER,GL.COLOR_ATTACHMENT0,GL.TEXTURE_CUBE_MAP_POSITIVE_X+a[m],this.texture,0),k&&!l?GL.framebufferRenderbuffer(GL.FRAMEBUFFER,GL.DEPTH_ATTACHMENT,GL.RENDERBUFFER,this.renderBuffer):
!k&&l?GL.framebufferRenderbuffer(GL.FRAMEBUFFER,GL.STENCIL_ATTACHMENT,GL.RENDERBUFFER,this.renderBuffer):k&&l&&GL.framebufferRenderbuffer(GL.FRAMEBUFFER,GL.DEPTH_STENCIL_ATTACHMENT,GL.RENDERBUFFER,this.renderBuffer)}GL.bindTexture(this.textureType,null);GL.bindRenderbuffer(GL.RENDERBUFFER,null);GL.bindFramebuffer(GL.FRAMEBUFFER,null)}var a={posX:0,negX:1,posY:2,negY:3,posZ:4,negZ:5};c.prototype.init=function(a){this.textureUnit=a};c.prototype.bind=function(a){this.textureType===GL.TEXTURE_2D?GL.bindFramebuffer(GL.FRAMEBUFFER,
this.frameBuffer):GL.bindFramebuffer(GL.FRAMEBUFFER,this.frameBuffers[a!==void 0?a:"posX"]);GL.viewport(this.viewport.x,this.viewport.y,this.viewport.width,this.viewport.height);return this};c.prototype.unbind=function(){GL.bindFramebuffer(GL.FRAMEBUFFER,null);GL.viewport(0,0,GLOW.currentContext.width,GLOW.currentContext.height);return this};c.prototype.setupViewport=function(a){this.viewport.x=a.x!==void 0?a.x:0;this.viewport.y=a.y!==void 0?a.y:0;this.viewport.width=a.width!==void 0?a.width:window.innerWidth;
this.viewport.height=a.height!==void 0?a.height:window.innerHeight;return this};c.prototype.resize=function(){return this};c.prototype.generateMipMaps=function(){GL.bindTexture(this.textureType,this.texture);GL.generateMipmap(this.textureType);GL.bindTexture(this.textureType,null);return this};return c}();
GLOW.Texture=function(){function c(a){if(a.url!==void 0)a.data=a.url;this.id=GLOW.uniqueId();this.data=a.data;this.autoUpdate=a.autoUpdate;this.internalFormat=a.internalFormat!==void 0?a.internalFormat:GL.RGBA;this.format=a.format!==void 0?a.format:GL.RGBA;this.type=a.type!==void 0?a.type:GL.UNSIGNED_BYTE;this.wrapS=a.wrapS!==void 0?a.wrapS:a.wrap!==void 0?a.wrap:GL.REPEAT;this.wrapT=a.wrapT!==void 0?a.wrapT:a.wrap!==void 0?a.wrap:GL.REPEAT;this.magFilter=a.magFilter!==void 0?a.magFilter:GL.LINEAR;
this.minFilter=a.minFilter!==void 0?a.minFilter:GL.LINEAR_MIPMAP_LINEAR;this.width=a.width;this.height=a.height;this.textureUnit=-1;this.texture=void 0}var a={posX:0,negX:1,posY:2,negY:3,posZ:4,negZ:5};c.prototype.init=function(b){this.textureUnit=b;if(typeof this.data==="string"){this.textureType=GL.TEXTURE_2D;var b=this.data,c=b.toLowerCase();if(c.indexOf(".jpg")!==-1||c.indexOf(".png")!==-1||c.indexOf(".gif")!==-1||c.indexOf("jpeg")!==-1)this.data=new Image,this.data.scope=this,this.data.onload=
this.onLoadImage;else{if(this.autoUpdate===void 0)this.autoUpdate=!0;this.data=document.createElement("video");this.data.scope=this;this.data.addEventListener("loadeddata",this.onLoadVideo,!1)}this.data.src=b}else if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement||this.data instanceof HTMLCanvasElement||this.data instanceof Uint8Array)this.textureType=GL.TEXTURE_2D,this.createTexture();else{this.textureType=GL.TEXTURE_CUBE_MAP;this.itemsToLoad=0;for(var e in a)this.data[e]!==
void 0?typeof this.data[e]==="string"&&this.itemsToLoad++:console.error("GLOW.Texture.init: data type error. Did you forget cube map "+e+"? If not, the data type is not supported");if(this.itemsToLoad===0)this.createTexture();else for(e in a)if(typeof this.data[e]==="string")b=this.data[e],c=b.toLowerCase(),c.indexOf(".jpg")!==-1||c.indexOf(".png")!==-1||c.indexOf(".gif")!==-1||c.indexOf("jpeg")!==-1?(this.data[e]=new Image,this.data[e].scope=this,this.data[e].onload=this.onLoadCubeImage):(this.autoUpdate!==
void 0?this.autoUpdate[e]=this.autoUpdate[e]!==void 0?this.autoUpdate[e]:!0:(this.autoUpdate={},this.autoUpdate[e]=!0),this.data[e]=document.createElement("video"),this.data[e].scope=this,this.data[e].addEventListener("loadeddata",this.onLoadCubeVideo,!1)),this.data[e].src=b}};c.prototype.createTexture=function(){this.texture=GL.createTexture();GL.bindTexture(this.textureType,this.texture);if(this.textureType===GL.TEXTURE_2D)if(this.data instanceof Uint8Array)if(this.width!==void 0&&this.height!==
void 0)GL.texImage2D(this.textureType,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.data);else{console.error("GLOW.Texture.createTexture: Textures of type Uint8Array requires width and height parameters. Quitting.");return}else GL.texImage2D(this.textureType,0,this.internalFormat,this.format,this.type,this.data);else for(var b in a)if(this.data[b]instanceof Uint8Array)if(this.width!==void 0&&this.height!==void 0)GL.texImage2D(GL.TEXTURE_CUBE_MAP_POSITIVE_X+a[b],0,this.internalFormat,
this.width,this.height,0,this.format,this.type,this.data[b]);else{console.error("GLOW.Texture.createTexture: Textures of type Uint8Array requires width and height parameters. Quitting.");return}else GL.texImage2D(GL.TEXTURE_CUBE_MAP_POSITIVE_X+a[b],0,this.internalFormat,this.format,this.type,this.data[b]);GL.texParameteri(this.textureType,GL.TEXTURE_WRAP_S,this.wrapS);GL.texParameteri(this.textureType,GL.TEXTURE_WRAP_T,this.wrapT);GL.texParameteri(this.textureType,GL.TEXTURE_MIN_FILTER,this.minFilter);
GL.texParameteri(this.textureType,GL.TEXTURE_MAG_FILTER,this.magFilter);this.minFilter!==GL.NEAREST&&this.minFilter!==GL.LINEAR&&GL.generateMipmap(this.textureType)};c.prototype.updateTexture=function(b){var b=b!==void 0?b:{},c=b.level!==void 0?b.level:0,e=b.xOffset!==void 0?b.xOffset:0,i=b.yOffset!==void 0?b.yOffset:0,f=b.updateMipmap!==void 0?b.updateMipmap:!0;GLOW.currentContext.cache.textureCached(this)||GL.bindTexture(this.textureType,this.texture);if(this.textureType==GL.TEXTURE_2D)this.data instanceof
Uint8Array?GL.texSubImage2D(this.textureType,c,e,i,this.width,this.height,this.format,this.type,this.data):GL.texSubImage2D(this.textureType,c,e,i,this.format,this.type,this.data);else for(var g in b)a[g]!==void 0&&(this.data[g]instanceof Uint8Array?GL.texSubImage2D(GL.TEXTURE_CUBE_MAP_POSITIVE_X+a[g],c,e,i,this.width,this.height,this.format,this.type,this.data[g]):GL.texSubImage2D(GL.TEXTURE_CUBE_MAP_POSITIVE_X+a[g],c,e,i,this.format,this.type,this.data[g]));this.minFilter!==GL.NEAREST&&this.minFilter!==
GL.LINEAR&&f===!0&&GL.generateMipmap(this.textureType)};c.prototype.onLoadImage=function(){this.scope.createTexture()};c.prototype.onLoadCubeImage=function(){this.scope.itemsToLoad--;this.scope.itemsToLoad===0&&this.scope.createTexture()};c.prototype.onLoadVideo=function(){this.removeEventListener("loadeddata",this.scope.onLoadVideo,!1);this.scope.createTexture()};c.prototype.onLoadCubeVideo=function(){this.removeEventListener("loadeddata",this.scope.onLoadVideo,!1);this.scope.itemsToLoad--;this.scope.itemsToLoad===
0&&this.scope.createTexture()};c.prototype.play=function(){if(this.textureType===GL.TEXTURE_2D)this.data instanceof HTMLVideoElement&&this.data.play();else for(var b in a)this.data[b]instanceof HTMLVideoElement&&this.data[b].play()};return c}();
GLOW.Shader=function(){function c(a){this.id=GLOW.uniqueId();this.compiledData=a.use?a.use.clone(a.except):GLOW.Compiler.compile(a);this.attachData()}c.prototype.attachData=function(){var a,b,c;this.uniforms=this.compiledData.uniforms;this.elements=this.compiledData.elements;this.program=this.compiledData.program;for(a in this.compiledData.uniforms)this[a]===void 0?this[a]=this.compiledData.uniforms[a].data:console.warn("GLOW.Shader.attachUniformAndAttributeData: name collision on uniform "+a+", not attaching for easy access. Please use Shader.uniforms."+
a+".data to access data.");for(b in this.compiledData.attributes){if(this.attributes===void 0)this.attributes=this.compiledData.attributes;this[b]===void 0?this[b]=this.compiledData.attributes[b]:console.warn("GLOW.Shader.attachUniformAndAttributeData: name collision on attribute "+b+", not attaching for easy access. Please use Shader.attributes."+b+".data to access data.")}for(c in this.compiledData.interleavedAttributes){if(this.interleavedAttributes===void 0)this.interleavedAttributes=this.compiledData.interleavedAttributes;
this[c]===void 0?this[c]=this.compiledData.interleavedAttributes[c]:console.warn("GLOW.Shader.attachUniformAndAttributeData: name collision on interleavedAttribute "+b+", not attaching for easy access. Please use Shader.interleavedAttributes."+b+".data to access data.")}};c.prototype.draw=function(){var a=this.compiledData,b=GLOW.currentContext.cache;if(!b.programCached(a.program)){GL.useProgram(a.program);var c=b.setProgramHighestAttributeNumber(a.program);if(c){var e=a.program.highestAttributeNumber,
i=e-c+1;if(c>0)for(;i<=e;i++)GL.enableVertexAttribArray(i);else for(;i>=e;i--)GL.disableVertexAttribArray(i)}}for(var f in a.uniforms)b.uniformCached(a.uniforms[f])||a.uniforms[f].load();for(var g in a.attributes)a.attributes[g].interleaved===!1&&(b.attributeCached(a.attributes[g])||a.attributes[g].bind());for(g in a.interleavedAttributes)a.interleavedAttributes[g].bind();a.preDrawCallback&&a.preDrawCallback(this);a.elements.draw();a.postDrawCallback&&a.postDrawCallback(this)};c.prototype.clone=function(a){return new GLOW.Shader({use:this.compiledData,
except:a})};c.prototype.dispose=function(){};return c}();
GLOW.Elements=function(){function c(a,b,c){this.id=GLOW.uniqueId();this.elements=GL.createBuffer();this.length=a.length;this.type=b!==void 0?b:GL.TRIANGLES;GL.bindBuffer(GL.ELEMENT_ARRAY_BUFFER,this.elements);GL.bufferData(GL.ELEMENT_ARRAY_BUFFER,a,c?c:GL.STATIC_DRAW)}c.prototype.draw=function(){GLOW.currentContext.cache.elementsCached(this)||GL.bindBuffer(GL.ELEMENT_ARRAY_BUFFER,this.elements);GL.drawElements(this.type,this.length,GL.UNSIGNED_SHORT,0)};c.prototype.dispose=function(){};return c}();
GLOW.Uniform=function(){function c(){d[GL.INT]=function(){GL.uniform1iv(this.location,this.getNativeValue())};d[GL.FLOAT]=function(){GL.uniform1fv(this.location,this.getNativeValue())};d[GL.INT_VEC2]=function(){GL.uniform2iv(this.location,this.getNativeValue())};d[GL.INT_VEC3]=function(){GL.uniform3iv(this.location,this.getNativeValue())};d[GL.INT_VEC4]=function(){GL.uniform4iv(this.location,this.getNativeValue())};d[GL.FLOAT_VEC2]=function(){GL.uniform2fv(this.location,this.getNativeValue())};d[GL.FLOAT_VEC3]=
function(){GL.uniform3fv(this.location,this.getNativeValue())};d[GL.FLOAT_VEC4]=function(){GL.uniform4fv(this.location,this.getNativeValue())};d[GL.FLOAT_MAT2]=function(){GL.uniformMatrix2fv(this.location,!1,this.getNativeValue())};d[GL.FLOAT_MAT3]=function(){GL.uniformMatrix3fv(this.location,!1,this.getNativeValue())};d[GL.FLOAT_MAT4]=function(){GL.uniformMatrix4fv(this.location,!1,this.getNativeValue())};d[GL.SAMPLER_2D]=function(){this.data.texture!==void 0&&this.data.textureUnit!==-1&&!GLOW.currentContext.cache.textureCached(this.data)&&
(GL.uniform1i(this.location,this.data.textureUnit),GL.activeTexture(GL.TEXTURE0+this.data.textureUnit),GL.bindTexture(GL.TEXTURE_2D,this.data.texture),this.data.autoUpdate&&this.data.updateTexture(this.data.autoUpdate))};d[GL.SAMPLER_CUBE]=function(){this.data.texture!==void 0&&this.data.textureUnit!==-1&&!GLOW.currentContext.cache.textureCached(this.data)&&(GL.uniform1i(this.location,this.data.textureUnit),GL.activeTexture(GL.TEXTURE0+this.data.textureUnit),GL.bindTexture(GL.TEXTURE_CUBE_MAP,this.data.texture),
this.data.autoUpdate&&this.data.updateTexture(this.data.autoUpdate))}}function a(a,i){b||(b=!0,c());this.id=GLOW.uniqueId();this.data=i;this.name=a.name;this.length=a.length;this.type=a.type;this.location=a.location;this.locationNumber=a.locationNumber;this.load=a.loadFunction||d[this.type]}var b=!1,d=[];a.prototype.getNativeValue=function(){return this.data.value};return a}();
GLOW.Attribute=function(){function c(c,e,i,f){a||(a=!0,b[GL.INT]=1,b[GL.INT_VEC2]=2,b[GL.INT_VEC3]=3,b[GL.INT_VEC4]=4,b[GL.FLOAT]=1,b[GL.FLOAT_VEC2]=2,b[GL.FLOAT_VEC3]=3,b[GL.FLOAT_VEC4]=4,b[GL.FLOAT_MAT2]=4,b[GL.FLOAT_MAT3]=9,b[GL.FLOAT_MAT4]=16);this.id=GLOW.uniqueId();this.data=e;this.location=c.location;this.locationNumber=c.locationNumber;this.offset=this.stride=0;this.usage=i!==void 0?i:GL.STATIC_DRAW;this.interleaved=f!==void 0?f:!1;this.size=b[c.type];this.name=c.name;this.type=c.type;this.interleaved===
!1&&(this.data instanceof Float32Array?this.bufferData(this.data,this.usage):console.error("GLOW.Attribute.constructor: Data for attribute "+this.name+" not in Float32Array format. Please fix. Quitting."))}var a=!1,b=[];c.prototype.setupInterleave=function(a,b){this.interleaved=!0;this.offset=a;this.stride=b};c.prototype.bufferData=function(a,b){if(a!==void 0&&this.data!==a)this.data=a;if(b!==void 0&&this.usage!==b)this.usage=b;if(this.buffer===void 0)this.buffer=GL.createBuffer();GL.bindBuffer(GL.ARRAY_BUFFER,
this.buffer);GL.bufferData(GL.ARRAY_BUFFER,this.data,this.usage)};c.prototype.bind=function(){this.interleaved===!1&&GL.bindBuffer(GL.ARRAY_BUFFER,this.buffer);GL.vertexAttribPointer(this.location,this.size,GL.FLOAT,!1,this.stride,this.offset)};c.prototype.clone=function(){this.interleaved?console.error("GLOW.Attribute.clone: Cannot clone interleaved attribute. Please check your interleave setup."):new GLOW.Attribute(this,this.data,this.usage,this.interleaved)};c.prototype.dispose=function(){};return c}();
GLOW.InterleavedAttributes=function(){function c(a){this.id=GLOW.uniqueId();this.attributes=a;var b,c=a[0].data.length/a[0].size,e,i=a.length,f,g,h,j=[],k,l=[];for(e=0;e<i;e++)j[e]=0;for(b=0;b<c;b++)for(e=0;e<i;e++){k=a[e].data;h=j[e];f=0;for(g=a[e].size;f<g;f++)l.push(k[h++]);j[e]=h}this.data=new Float32Array(l);this.usage=a[0].usage;for(e=0;e<i;e++)if(this.usage!==a[e].usage){console.warn("GLOW.InterleavedAttributes.construct: Attribute "+a[e].name+" has different usage, defaulting to STATIC_DRAW.");
this.usage=GL.STATIC_DRAW;break}this.bufferData(this.data,this.usage);for(e=b=0;e<i;e++)b+=a[e].size*4;for(e=c=0;e<i;e++)a[e].setupInterleave(c,b),c+=a[e].size*4}c.prototype.bufferData=function(a,b){if(a!==void 0&&this.data!==a)this.data=a;if(this.buffer===void 0)this.buffer=GL.createBuffer();GL.bindBuffer(GL.ARRAY_BUFFER,this.buffer);GL.bufferData(GL.ARRAY_BUFFER,this.data,b?b:GL.STATIC_DRAW)};c.prototype.bind=function(){GL.bindBuffer(GL.ARRAY_BUFFER,this.buffer);var a,b=this.attributes.length;for(a=
0;a<b;a++)this.attributes[a].bind()};return c}();
